---
title: "Ubuntu-minimalã®Snapç‰ˆChromiumã§headlessãƒ¢ãƒ¼ãƒ‰ãŒå‹•ã‹ãªã„ã¨ãã®å¯¾å‡¦"
emoji: "ğŸ£"
type: "tech"
topics: ["chromium", "headless", "snap", "ubuntu"]
published: true
---

Ubuntu-minimalç’°å¢ƒã§Snapç‰ˆChromiumã®headlessãƒ¢ãƒ¼ãƒ‰ãŒå‹•ã‹ãªã‹ã£ãŸã¨ãã®ãƒ¡ãƒ¢ã§ã™ã€‚
åŸå› ã¯ã€ãƒ•ã‚©ãƒ³ãƒˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã“ã¨ãŒåŸå› ã®ã‚ˆã†ã§ã€ãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€Snapç‰ˆChromiumã‚’å†åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚

# äº‹è±¡ç™ºç”Ÿæ™‚ã®ç’°å¢ƒ

```
$ cat /etc/os-release
NAME="Ubuntu"
VERSION="20.04.2 LTS (Focal Fossa)"
...
```

Ubuntuã¯19.10é ƒã‹ã‚‰debç‰ˆã®ChromiumãŒå»ƒæ­¢ã•ã‚Œã€Snapç‰ˆã§ã®ã¿æä¾›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚å½“è©²ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Chromiumã¯Snapç‰ˆã®ã¿ã€‚

# äº‹è±¡ã®å†…å®¹

Chromiumã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
$ chromium

Command 'chromium' not found, but can be installed with:

sudo snap install chromium

$ sudo snap install chromium
chromium 89.0.4389.72 from Canonicalâœ“ installed
$ chromium --version
Chromium 89.0.4389.72 snap
```

Chromiumã‚’å®Ÿè¡Œ

```
$ chromium --headless
[0305/151916.045248:WARNING:headless_content_main_delegate.cc(530)] Cannot create Pref Service with no user data dir.
[0305/151916.263772:ERROR:vaapi_wrapper.cc(573)] Could not get a valid VA display
Trace/breakpoint trap (core dumped)
```

ã‚³ã‚¢ãƒ€ãƒ³ãƒ—ã¨ã¨ã‚‚ã«ä¸€ç•ªæ‰‹å‰ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç•°å¸¸çµ‚äº†ã™ã‚‹ã€‚

# ä¿®æ­£

ä»»æ„ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã«ã€`snap disable chromium` -> `snap enable chromium` ã§è§£æ¶ˆã—ãŸã€‚

```
$ sudo apt install fonts-dejavu-core
Reading package lists... Done
...
Setting up fonts-dejavu-core (2.37-1) ...
$ sudo snap disable chromium
chromium disabled
$ sudo snap enable chromium
chromium enabled
$ chromium --headless
[0306/010646.813105:WARNING:headless_content_main_delegate.cc(530)] Cannot create Pref Service with no user data dir.
[0306/010646.859949:ERROR:vaapi_wrapper.cc(573)] Could not get a valid VA display
$
```

# åŸå› 

ä¸‹è¨˜ã§ãƒ¬ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã€‚
https://bugs.launchpad.net/ubuntu/+source/chromium-browser/+bug/1908284
ãƒ•ã‚©ãƒ³ãƒˆé–¢é€£ã§å½“è©²äº‹è±¡ãŒç™ºç”Ÿã—ã¦ã„ã‚‹æ¨¡æ§˜ã€‚

æ‰‹å…ƒã®ç’°å¢ƒã§ç¢ºèªã—ãŸã¨ã“ã‚ã€Chromiumã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ç‚¹ã§ãƒ•ã‚©ãƒ³ãƒˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã«ç™ºç”Ÿã™ã‚‹ã€‚
Snapã®[Desktop Extensions Font Hook](https://github.com/snapcore/snapcraft/blob/master/specifications/desktop-extensions-font-hook.org)ã«ã‚ˆã‚Š[ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç”Ÿæˆ](https://github.com/snapcore/snapcraft/blob/f5f6ed6fe6e4f32d188dbaf5ec3d5740c6cd7e4e/extensions/desktop/common/fonts#L43)ã•ã‚Œã‚‹ãŸã‚ã€snapã®å¤–å´ã§ãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆã¯ã€å†åº¦å½“è©²Hookã‚’èµ°ã‚‰ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ãã®ãŸã‚ã€ãƒ•ã‚©ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«

- snap remove / installã‚’å®Ÿè¡Œ
- snap disable / enableã‚’å®Ÿè¡Œ

ã®ã„ãšã‚Œã‹ã§è§£æ¶ˆã™ã‚‹ã¨ã®çµè«–ã«è‡³ã£ãŸã€‚

# ã•ã„ã”ã«

Snapã¯ãƒãƒ¼ã‚¿ãƒ–ãƒ«ã§ã€ã‚»ã‚­ãƒ¥ã‚¢ãªç´ æ•µãªä»•çµ„ã¿ã ãŒã€ã¾ã Snapã®å¤–å´ã¨ã®ã‚„ã‚Šå–ã‚ŠãŒæ¯ã‚Œã¦ã„ãªã„ãªã¨å®Ÿæ„Ÿã—ãŸã€‚
æ™®æ®µã¯Arch Linuxä½¿ã„ã§Snapã¯ã‚ã¾ã‚Šæ°—ã«ã—ã¦ã„ãªã‹ã£ãŸãŒã€Snapé›£ã—ã„ãªã€‚ã€‚

[yskszk63/chrome-remote-interface-rs](https://github.com/yskszk63/chrome-remote-interface-rs)ã§GitHub Actionsæ›¸ã„ã¦ã„ã‚‹ã¨ãã«Snapã§è‰²ã€…ã‚ã£ãŸã†ã¡ã®ä¸€ã¤ã§ã™ã€‚
